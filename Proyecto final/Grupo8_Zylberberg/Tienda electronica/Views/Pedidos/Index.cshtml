@model Tienda_electronica.Models.PedidosIndexViewModel
@{
    ViewData["Title"] = "Mis Pedidos";
    Layout = "_Layout";
    var esUsuario = User.IsInRole("Usuario");
}

<div class="container py-5">
    <h1 class="mb-4">Mis Pedidos</h1>

    @if (!Model.Activos.Any() && !Model.Completados.Any())
    {
        <div class="alert alert-info">
            No tienes pedidos todavía.
            <a asp-controller="Productos" asp-action="Index">Ver productos</a>
        </div>
        return;
    }

    <!-- Navegación de pestañas -->
    <ul class="nav nav-tabs mb-4" id="tabsPedidos" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="tab-activos"
                    data-bs-toggle="tab" data-bs-target="#pane-activos"
                    type="button" role="tab">
                Activos (@Model.Activos.Count)
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="tab-completados"
                    data-bs-toggle="tab" data-bs-target="#pane-completados"
                    type="button" role="tab">
                Completados (@Model.Completados.Count)
            </button>
        </li>
    </ul>

    <div class="tab-content">
        <!-- Activos -->
        <div class="tab-pane fade show active" id="pane-activos" role="tabpanel">
            <div class="row g-4">
                @foreach (var pedido in Model.Activos)
                {
                    <div class="col-sm-12 col-md-6">
                        <!-- Aquí reutilizas tu card de pedido, o la vuelves a pegar -->
                        <div class="card h-100 shadow-sm">
                            <div class="card-header bg-warning text-dark">
                                <strong>Pedido #@pedido.IdPedido</strong>
                                <span class="badge bg-light text-dark float-end">Abierto</span><br />
                                <small>@pedido.Fecha:g</small>
                            </div>
                            <div class="card-body">
                                <ul class="list-unstyled mb-3">
                                    @foreach (var d in pedido.Detalles)
                                    {
                                        <li>
                                            @d.Producto.Nombre
                                            <span class="badge bg-secondary">@d.Cantidad×</span>
                                        </li>
                                    }
                                </ul>
                                <a asp-action="Details" asp-route-id="@pedido.IdPedido"
                                   class="btn btn-sm btn-outline-primary">Ver detalles</a>
                                @if (esUsuario)
                                {
                                    <form asp-action="Delete" asp-route-id="@pedido.IdPedido" method="post" class="d-inline ms-2" onsubmit="return confirm('¿Estás seguro de que deseas eliminar este pedido?');">
                                        <button type="submit" class="btn btn-sm btn-outline-danger">Eliminar</button>
                                    </form>
                                }
                            </div>
                            <div class="card-footer text-end">
                                <strong>Total:</strong> @pedido.Total.ToString("C")
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>

        <!-- Completados -->
        <div class="tab-pane fade" id="pane-completados" role="tabpanel">
            <div class="row g-4">
                @foreach (var pedido in Model.Completados)
                {
                    <div class="col-sm-12 col-md-6">
                        <div class="card h-100 shadow-sm">
                            <div class="card-header bg-success text-white">
                                <strong>Pedido #@pedido.IdPedido</strong>
                                <span class="badge bg-light text-dark float-end">Completado</span><br />
                                <small>@pedido.Fecha:g</small>
                            </div>
                            <div class="card-body">
                                <ul class="list-unstyled mb-3">
                                    @foreach (var d in pedido.Detalles)
                                    {
                                        <li>
                                            @d.Producto.Nombre
                                            <span class="badge bg-secondary">@d.Cantidad×</span>
                                        </li>
                                    }
                                </ul>
                                <a asp-action="Details" asp-route-id="@pedido.IdPedido"
                                   class="btn btn-sm btn-outline-primary">Ver detalles</a>
                                @if (esUsuario)
                                {
                                    <form asp-action="Delete" asp-route-id="@pedido.IdPedido" method="post" class="d-inline ms-2" onsubmit="return confirm('¿Estás seguro de que deseas eliminar este pedido?');">
                                        <button type="submit" class="btn btn-sm btn-outline-danger">Eliminar</button>
                                    </form>
                                }
                            </div>
                            <div class="card-footer text-end">
                                <strong>Total:</strong> @pedido.Total.ToString("C")
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
</div>